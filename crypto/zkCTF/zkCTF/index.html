
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="2024 | CTF | Crypto">
      
      
        <meta name="author" content="Xor0v0">
      
      
        <link rel="canonical" href="https://xor0v0.github.io/ZK-Puzzle-Writeups/crypto/zkCTF/zkCTF/">
      
      
        <link rel="prev" href="../../2%2B2%3D5/two_plus_two/">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Crypto - zkCTF WP - ZK Puzzle Writeups</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#day-1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="ZK Puzzle Writeups" class="md-header__button md-logo" aria-label="ZK Puzzle Writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZK Puzzle Writeups
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Crypto - zkCTF WP
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Xor0v0/ZK-Puzzle-Writeups" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Xor0v0/ZK-Puzzle-Writeups
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  简介

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../oven/" class="md-tabs__link">
          
  
  Crypto

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ZK Puzzle Writeups" class="md-nav__button md-logo" aria-label="ZK Puzzle Writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"/></svg>

    </a>
    ZK Puzzle Writeups
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Xor0v0/ZK-Puzzle-Writeups" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Xor0v0/ZK-Puzzle-Writeups
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    简介
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Crypto
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Crypto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oven/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oven
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lets-hash-it-out/lets-hash-it-out/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Let's hash it out
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../safeescrow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SafeEscrow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../group-dynamics/group-dynamics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Group dynamics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2%2B2%3D5/two_plus_two/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2+2=5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    zkCTF
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    zkCTF
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#day-1" class="md-nav__link">
    <span class="md-ellipsis">
      Day 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kid-math" class="md-nav__link">
    <span class="md-ellipsis">
      Kid Math
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#division-quiz" class="md-nav__link">
    <span class="md-ellipsis">
      Division Quiz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roundabout" class="md-nav__link">
    <span class="md-ellipsis">
      Roundabout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethereal" class="md-nav__link">
    <span class="md-ellipsis">
      Ethereal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ethereal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exp" class="md-nav__link">
    <span class="md-ellipsis">
      EXP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-2" class="md-nav__link">
    <span class="md-ellipsis">
      Day 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is-zero" class="md-nav__link">
    <span class="md-ellipsis">
      Is Zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixer" class="md-nav__link">
    <span class="md-ellipsis">
      Mixer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#familiar-strangers" class="md-nav__link">
    <span class="md-ellipsis">
      Familiar Strangers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Familiar Strangers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_1" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-a-waste" class="md-nav__link">
    <span class="md-ellipsis">
      What a Waste
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#day-1" class="md-nav__link">
    <span class="md-ellipsis">
      Day 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kid-math" class="md-nav__link">
    <span class="md-ellipsis">
      Kid Math
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#division-quiz" class="md-nav__link">
    <span class="md-ellipsis">
      Division Quiz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roundabout" class="md-nav__link">
    <span class="md-ellipsis">
      Roundabout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethereal" class="md-nav__link">
    <span class="md-ellipsis">
      Ethereal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ethereal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exp" class="md-nav__link">
    <span class="md-ellipsis">
      EXP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-2" class="md-nav__link">
    <span class="md-ellipsis">
      Day 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is-zero" class="md-nav__link">
    <span class="md-ellipsis">
      Is Zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixer" class="md-nav__link">
    <span class="md-ellipsis">
      Mixer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#familiar-strangers" class="md-nav__link">
    <span class="md-ellipsis">
      Familiar Strangers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Familiar Strangers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_1" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-a-waste" class="md-nav__link">
    <span class="md-ellipsis">
      What a Waste
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>zkCTF</h1>

<h2 id="day-1">Day 1<a class="headerlink" href="#day-1" title="Permanent link">&para;</a></h2>
<p>Puzzles: <a href="https://github.com/scalebit/zkCTF-day1">https://github.com/scalebit/zkCTF-day1</a></p>
<h3 id="kid-math">Kid Math<a class="headerlink" href="#kid-math" title="Permanent link">&para;</a></h3>
<p>We need to implement a Fibonacci  Chip using <a href="https://zcash.github.io/halo2/">Halo2</a> and pass the given test cases.</p>
<p>Note that the <code>pb</code> in the first row is given (<code>pb = 127</code>) and <code>pa</code> in next rows is also given (<code>pa = 125</code>). So all we need to do is to construct appropriate constraint relationships using the existing conditions mentioned above, So everyone's answer may be different.</p>
<p>My constraint is : <code>-a * pa + b * pb - c - pc == 0</code>, where <code>pa = 125, pb = 127, pc = 126</code>. and the output is <code>134</code>.</p>
<h3 id="division-quiz">Division Quiz<a class="headerlink" href="#division-quiz" title="Permanent link">&para;</a></h3>
<p>Another Halo2 puzzle involves lookup table and it requires us to constrain DIV operation, where the dividend is within a certain range.</p>
<p>2 constraint have to satisfy:</p>
<ol>
<li>dividend = divisor * quiotient + reminder</li>
<li>reminder &lt; divisor</li>
</ol>
<p>For the first constraint, we can achieve it using a custom gate. For the second constraint, either use a lookup range proofs or use a addtion gate <code>b = r + k</code>. In addition, we should check all of these value <code>a, b, c, r, k</code> are in certain bits range, e.g [0, 1 &lt;&lt; 128] for u128 division.</p>
<h3 id="roundabout">Roundabout<a class="headerlink" href="#roundabout" title="Permanent link">&para;</a></h3>
<p>The <code>Roundabout.circom</code> uses MiMCSponge template to generate hash, and the puzzle part lies in:</p>
<div class="highlight"><pre><span></span><code>template Gift () {
    signal input a;
    signal input b;
    signal c;
    signal b_sq;
    signal c_sq;
    signal output d;

    component m = MiMCSponge(1,2,1);
    m.ins[0] &lt;== a;
    m.k &lt;== 1;
    c &lt;== m.outs[0];
    c === 3066844496547985532785966973086993824;

    b_sq &lt;== b * b;
    c_sq &lt;== c * c;

    assert(b_sq &lt; 999999999);

    9 * b_sq + 37622140664026667386099315436167897444086165906536960040182069717656571868 === c_sq * b_sq; 

    d &lt;== b * a;
}
</code></pre></div>
<p>To solve the puzzle, we need to reverse the template input <code>a, b</code> and output the expected <code>d</code>.</p>
<p><img alt="feistel" class="center" src="../imgs/feistel.png" width="40%" /></p>
<p>Note that the MiMCSponge hasher is initialized as <code>component m = MiMCSponge(1,2,1);</code>, which means that it takes in one input and output a result. And it will run only two rounds of Feistel network internally. As a result:</p>
<div class="arithmatex">\[
xL_{in}=a \\
xR_{in}=0 \\
k = 1\\
t = k+xL_{in}=1+a \\
t2 = t^2=(1+a)^2 \\ 
t4={t2}^2=(1+a^4) \\
xL_0 = xR_{in} + t4 * t=(1+a)^5 \\
xR_1 = xL_{in} = a
\]</div>
<p><code>S[0].xL_{out}=(1+a)^5=3066844496547985532785966973086993824</code>, so <code>a=19830713</code> and b can be easily compute <code>b=2</code>.</p>
<p>If one doesn't know about feistel construction, it can simply try some inputs and observe the output of <code>MiMCSponge(1, 2, 1)</code> is increasing. Then it can use binary search to try and get the input.</p>
<h3 id="ethereal">Ethereal<a class="headerlink" href="#ethereal" title="Permanent link">&para;</a></h3>
<h4 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h4>
<p>Welcome to Ethereal. Here, your quest is to forge the Seed Blade, a powerful sword assembled from 10 mystical parts. With each part, your blade becomes stronger, symbolizing your growing cryptographic mastery.</p>
<p>Your challenge: to mint Gems with this blade. 
Mint 10 gems, and you demonstrate your skill and balance. 
Mint 20, and you push the boundaries of your abilities. But beware, each gem brings both power and peril. Will your Seed Blade be a tool of wisdom or lead to your downfall? The path is yours to choose.</p>
<h4 id="analysis">Analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h4>
<p>We are given a <code>mint-client</code> directory  which generated by <a href="https://geth.ethereum.org/docs/tools/abigen">abigen</a> to help us interact with smart contracts, and a <code>mint-contracts</code> directory containinig smart contract source code.</p>
<p>First of all, we look into the contract part. The most important part is the Mint contract in <code>mint-contracts/src/MinGem.sol</code> which defines the main logic of the puzzle.</p>
<details>
<summary><font color=MediumAquamarine>Check contract source code 👀</font></summary>

<div class="highlight"><pre><span></span><code><span class="k">contract</span><span class="w"> </span><span class="ni">Mint</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Verifier<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">DepositInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">registered</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">nonce</span><span class="p">;</span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>commitment<span class="p">;</span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>soulBox<span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span>collectedY<span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">escaped0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">escaped1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// function is_sovled(DepositInfo info) returns (bool) {</span>
<span class="w">    </span><span class="c1">//     if(DepositInfo.escaped0 &amp;&amp; DepositInfo escaped1)</span>
<span class="w">    </span><span class="c1">//     {return true;}</span>
<span class="w">    </span><span class="c1">//     else</span>
<span class="w">    </span><span class="c1">//     {return false;}</span>
<span class="w">    </span><span class="c1">// }</span>


<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getCollectedY</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">user</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>deposits<span class="p">[</span>user<span class="p">].</span>collectedY<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>DepositInfo<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>deposits<span class="p">;</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Deposit</span><span class="p">(</span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>indexed<span class="w"> </span>soulbox<span class="p">,</span><span class="w"> </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>commitment<span class="p">,</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Minted</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>user<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">nonce</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Pwned</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>privateKey<span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">register</span><span class="p">(</span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>calldata<span class="w"> </span>_commitment<span class="p">,</span><span class="w"> </span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>calldata<span class="w"> </span>_proof<span class="p">,</span><span class="w"> </span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>calldata<span class="w"> </span>_soulBox
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>deposits<span class="p">[</span>sender<span class="p">].</span>registered<span class="p">,</span><span class="w"> </span><span class="s2">&quot;User registered&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>verifySoulBox<span class="p">(</span>_commitment<span class="p">,</span><span class="w"> </span>_proof<span class="p">,</span><span class="w"> </span>_soulBox<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Invalid  soul box proof&quot;</span><span class="p">);</span>
<span class="w">        </span>deposits<span class="p">[</span>sender<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DepositInfo<span class="p">({</span>
<span class="w">            </span>registered<span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span>nonce<span class="o">:</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span>commitment<span class="o">:</span><span class="w"> </span>_commitment<span class="p">,</span>
<span class="w">            </span>soulBox<span class="o">:</span><span class="w"> </span>_soulBox<span class="p">,</span>
<span class="w">            </span>collectedY<span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint256</span><span class="p">[](</span><span class="m m-Decimal">0</span><span class="p">),</span>
<span class="w">            </span>escaped0<span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">            </span>escaped1<span class="o">:</span><span class="w"> </span><span class="kt">false</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span>emit<span class="w"> </span>Deposit<span class="p">(</span>_soulBox<span class="p">,</span><span class="w"> </span>_commitment<span class="p">,</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getNonce</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_user</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>deposits<span class="p">[</span>_user<span class="p">].</span>nonce<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">mint</span><span class="p">(</span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span>calldata<span class="w"> </span>_proof<span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_value</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">nonce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getNonce<span class="p">(</span>sender<span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>deposits<span class="p">[</span>sender<span class="p">].</span>registered<span class="p">,</span><span class="w"> </span><span class="s2">&quot;User registered&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>verify<span class="p">(</span>deposits<span class="p">[</span>sender<span class="p">].</span>commitment<span class="p">,</span><span class="w"> </span>_proof<span class="p">,</span><span class="w"> </span>nonce<span class="p">,</span><span class="w"> </span>_value<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Invalid mint proof&quot;</span><span class="p">);</span>
<span class="w">        </span>deposits<span class="p">[</span>sender<span class="p">].</span>collectedY<span class="p">.</span>push<span class="p">(</span>_value<span class="p">);</span>

<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>xArray<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint256</span><span class="p">[](</span>nonce<span class="p">);</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>nonce<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>xArray<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>i<span class="o">+</span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>wArray<span class="w"> </span><span class="o">=</span><span class="w"> </span>getBarycentricWeights<span class="p">(</span>xArray<span class="p">);</span>
<span class="w">        </span><span class="c1">// recover private_key = f(0) by lagrange interpolation</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">soul</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>evaluateBarycentricPolynomial<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>deposits<span class="p">[</span>sender<span class="p">].</span>collectedY<span class="p">,</span><span class="w"> </span>wArray<span class="p">);</span>
<span class="w">        </span>Pairing<span class="p">.</span>G1Point<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>soulBox<span class="w"> </span><span class="o">=</span><span class="w"> </span>Pairing<span class="p">.</span>mulScalar<span class="p">(</span>SRS_G1_0<span class="p">,</span><span class="w"> </span>soul<span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>soulBox<span class="p">.</span>X<span class="w"> </span><span class="o">!=</span><span class="w"> </span>deposits<span class="p">[</span>sender<span class="p">].</span>soulBox<span class="p">.</span>X<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Soul dispersed&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">if</span><span class="p">(</span>nonce<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">){</span>
<span class="w">            </span>deposits<span class="p">[</span>sender<span class="p">].</span>escaped0<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">if</span><span class="p">(</span>nonce<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">20</span><span class="p">){</span>
<span class="w">            </span>deposits<span class="p">[</span>sender<span class="p">].</span>escaped1<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>emit<span class="w"> </span>Minted<span class="p">(</span>sender<span class="p">,</span><span class="w"> </span>deposits<span class="p">[</span>sender<span class="p">].</span>nonce<span class="p">);</span>
<span class="w">        </span>deposits<span class="p">[</span>sender<span class="p">].</span>nonce<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">replay</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>deposits<span class="p">[</span>sender<span class="p">].</span>registered<span class="p">,</span><span class="w"> </span><span class="s2">&quot;User not registered&quot;</span><span class="p">);</span>
<span class="w">        </span>delete<span class="p">(</span>deposits<span class="p">[</span>sender<span class="p">]);</span>
<span class="w">        </span>delete<span class="p">(</span>deposits<span class="p">[</span>sender<span class="p">].</span>collectedY<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</details>

<p>The register function takes in 3 inputs: a KZG cimmitment <code>_commitment</code> of polynomial, a opening proof <code>_proof</code> of corresponding polynomial and a publicKey <code>_soulBox</code>. The 3 stuffs can be generate by <code>CraftBladeSignature</code> in <code>mint-client/blacksmith.go</code> and it is actually a KZG opening proof of a sword polynomial which is generated by random and stored in the <code>sword.json</code> at index <code>0</code>. So the privateKey is actually the first number of <code>sword.json</code>.</p>
<p>Note that <code>verifySoulBox</code> method will verify the KZG openning proof of index 0.</p>
<p>we can check it by running:</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>run<span class="w"> </span>.<span class="w"> </span>-contract<span class="w"> </span>0x5fbdb2315678afecb367f032d93f642f64180aa3<span class="w"> </span>-action<span class="w"> </span>register
<span class="c1"># (*big.Int)(0xc000126000)(7387512810814433601023902593855093598498966062809372162954534333509796980828)</span>
<span class="c1"># (*bn254.G1Affine)(0xc000128040)(E([4663152887034778978712025808205539272224485928059866901645348175989267801382,7337163707989781172140860281787651571090746340470207475573012821654567505278]))</span>
</code></pre></div>
<p>When we mint gems, we should provide a opening proof of sword poly at the index of <code>nonce</code>. Note that the nonce of user's desposit information in the contract is initialized by 1. The contract will verify the opening proof and further the Mint contract is trying to recover the privateKey f(0) of the sword poly, minting will fail if it is recovered successfully.</p>
<p>In order to solve this puzzle, we need to mint 20 gems. However, according to the SRS given in the <code>Constant.sol</code>, we can only generate 16 openning proof at most (the first one is the privateKey (soul) so that we can not use it to produce a opening proof).</p>
<p>Obviously, the size of SRS is limited and this is acttually a Rate Limitinmg Nullifier (RLN) protocol on the KZG version. The security of the protocol guaranteed by the <strong>polynomial interpolation theorem</strong>.</p>
<p>There are two ways to solve the problem:</p>
<ol>
<li>Can we recover the trapdoor of the SRS so that we can add the length of SRS and forge a polynomial of degree &gt; 20?</li>
<li>Is the protocol has some vulnerability to allow us forge proofs that these points do not lie on the polynomial of degree 16, like malleable attack?</li>
</ol>
<p>Both methods are feasible.</p>
<p>For #Method 1, by googling the <code>SRS_G1_X=0x2f588cffe99db877a4434b598ab28f81e0522910ea52b45f0adaa772b2d5d352</code>, we can find this <a href="https://github.com/matter-labs/era-compiler-tests/blob/9a8c6d99d84cec7343e79a28b2a6df49aef57796/yul/precompiles/ecmul_source.yul#L68-L82">repo</a>. It leaked the trapdoor value: <code>115792089237316195423570985008687907853269984665640564039457584007913129639935</code>. I think this is an unexpected solution :)</p>
<p>For #Method 2, this <a href="https://hackmd.io/@n1trox/SJlFMYlr2">article</a> introduces the attack vector to forge kzg opening proofs without knowing the trapdoor value.</p>
<p>In detail, we notice that <code>KZGVerifier.verifySoulBox</code> checks the pairing equation when <span class="arithmatex">\(u=0\)</span>:</p>
<div class="arithmatex">\[
e(g^{f(\tau)-f(u)},g)\overset{?}=e(g^{h(\tau)},g^{(\tau-u)})
\]</div>
<p>Normally, we should input <span class="arithmatex">\(f(u)\)</span> (specifically <code>_value</code> or <code>soul</code>), <span class="arithmatex">\(u\)</span> (specifically <code>_index</code>) and <span class="arithmatex">\(h(\tau)\)</span> (sepecifically <code>_proof</code>). In order to reduce the amounts of <span class="arithmatex">\(\mathbb{G}_2\)</span> element, we perform the following transformation:</p>
<div class="arithmatex">\[
e(g^{f(\tau)-f(u)},g)\overset{?}= e(g^{h(\tau)},g^{(\tau-u)}) \\
\Rightarrow e(g^{f(\tau)-f(u)},g)\cdot e(g,g)^{-h(\tau)\cdot(\tau-u))}\overset{?}=1\\
\Rightarrow e(g^{f(\tau)-f(u)},g)^{u\cdot h(\tau)}\cdot e(g,g)^{-h(\tau)\cdot \tau}\overset{?}=1\\
\Rightarrow e(g^{u\cdot h(\tau)+f(\tau)-f(u)},g)\cdot e(g^{-h(\tau)},g^\tau)\overset{?}=1
\]</div>
<p>That is the code implementation corresponding to the puzzle. When <span class="arithmatex">\(u=0\)</span>, we can use the attack vector to forge arbitary proofs.</p>
<ol>
<li>select a random field element <span class="arithmatex">\(\gamma\)</span>;</li>
<li>construct the new value <span class="arithmatex">\(nv = g^{f(0)-\gamma\tau}\)</span> and new proof <span class="arithmatex">\(nf=g^{h(\tau)+\gamma}\)</span></li>
</ol>
<p>Let us verify its correctness:</p>
<div class="arithmatex">\[
e(g^{f(\tau)-f(0)},g)\cdot e(g^{-h(\tau)},g^\tau)\overset{?}=1\\
\Rightarrow e(g^{f(\tau)-(f(0)-\gamma\tau)},g)\cdot e(g^{-(h(\tau)+\gamma)},g^\tau)\overset{?}=1
\]</div>
<p>Then the polynomial equation is:</p>
<div class="arithmatex">\[
f(\tau)-(f(0)-\gamma\tau)=(h(\tau)+\gamma)\cdot\tau\\
\Rightarrow f(\tau)-f(0)+\gamma\tau=h(\tau)\tau+\gamma\tau\\
\Rightarrow f(\tau)-f(0)=h(\tau)\tau\\
\]</div>
<p>Correct!</p>
<p>Therefore, we can register with the fake opening proof generated by the existing soulBox and its opening proof. Tee contract will pass the register process and then it can no longer recover the privateKey f(0) because the fake soulBox is a point that does not lie on the polynomial of degree 16 and the protocol loses efficacy.</p>
<h4 id="exp">EXP<a class="headerlink" href="#exp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>case &quot;forge&quot;:
        // 1. load sword info
        var sword []fr.Element
        f, err := os.Open(&quot;sword.json&quot;)
        panicErr(err)
        defer f.Close()
        decoder := json.NewDecoder(f)
        err = decoder.Decode(&amp;sword)
        panicErr(err)

        // 2. forge
        bladeCommitment, bladeProof := CraftBladeSignature(sword, SRS)
        commitmentPoint := G1AffineToG1Point(&amp;bladeCommitment)
        // forge the fake bladeProof
        var fakeProof bn254.G1Affine
        fakeProof.ScalarMultiplication(&amp;SRS.Pk.G1[0], big.NewInt(114514)) // g^{114514})
        spew.Dump(fakeProof)
        fakeProof.Add(&amp;fakeProof, &amp;bladeProof.H)
        spew.Dump(fakeProof)
        bladeProofPoint := G1AffineToG1Point(&amp;fakeProof)
        spew.Dump(bladeProofPoint)

        var fakeSoulBox bn254.G1Affine
        fakeSoulBox.ScalarMultiplication(&amp;SRS.Pk.G1[1], big.NewInt(114514)) // g^{\tau * 114514})
        fakeSoulBox.Sub(&amp;bladeProof.PublicKeyG1Aff, &amp;fakeSoulBox)
        soulBox := G1AffineToG1Point(&amp;fakeSoulBox)

        // 3. register
        mintContract.Register(transactor, *commitmentPoint, *bladeProofPoint, *soulBox)
    }
</code></pre></div>
<p>After register, when can mint as much as we want!</p>
<h2 id="day-2">Day 2<a class="headerlink" href="#day-2" title="Permanent link">&para;</a></h2>
<p>Puzzles: <a href="https://github.com/scalebit/zkCTF-day2">https://github.com/scalebit/zkCTF-day2</a></p>
<h3 id="is-zero">Is Zero<a class="headerlink" href="#is-zero" title="Permanent link">&para;</a></h3>
<p>This is a simple is_zero circuit implement. According to the test case, we know that the input arrays <code>a, b</code> are the input and result respectively.</p>
<p>The 3 advice columns are repectively a, a_inv and b. Then We configure and asssign them.</p>
<h3 id="mixer">Mixer<a class="headerlink" href="#mixer" title="Permanent link">&para;</a></h3>
<p>We are required to drain the immutable contract Mixer.</p>
<p>The implementation is quiet similar with the <a href="https://www.rareskills.io/post/how-does-tornado-cash-work">Tornado Cash</a> protocol. One can deposit 1 ether with a commitment (usually a hash of some secret value), then withdraw by providing the corresponding proof that the secret value can be exactly used to generate the commitment. <a href="https://hackmd.io/@liangcc/nullifier">Nullifier</a> is a clever mechinism that make sure  a message only takes effect once. It is the nullifiers keep the protocol from suffering double-spending attack and nullifiers have something to do with the secret value so that verifier can check the prover indeed owns the secret value to generate the corresponding commitment.</p>
<p>When it comes to draining a tornado cash protocol, the first possibility that comes to my mind is if we can forge the nullifiers. One should always pay attention to the field operation in the zk application and always check the input data validation.</p>
<p>According to the code given in the <code>Verifier.sol</code>, we notice the finite field that protocol works on is <span class="arithmatex">\(\mathbb{F}_p\)</span>, where <span class="arithmatex">\(p=21888242871839275222246405745257275088548364400416034343698204186575808495617\)</span>, known as the modulus of bn254 curve. But uint256 in solidity can represent a number of 256 bits, so it remains a huge space for hackers to forge nullifiers. Therefore, protocol has to check that the range of nullifier is strictly within finite field. However, it does not.</p>
<p>So we can repeatly withdraw funds with the same proof and commitment using as many as nullifiers we want by adding <code>p</code> repeatly, until the contract drains.</p>
<h3 id="familiar-strangers">Familiar Strangers<a class="headerlink" href="#familiar-strangers" title="Permanent link">&para;</a></h3>
<h4 id="description_1">Description<a class="headerlink" href="#description_1" title="Permanent link">&para;</a></h4>
<p>In the realm of the familiar, where logic gates are the silent sentinels of truth, lies a challenge shrouded in enigma. "Familiar Strangers" beckons you to a world where the simplest of circuits hide secrets just beyond the veil of obviousness. These circuits, reminiscent of the ones you've met countless times, now hold a mystery that only a true Circom savant can unravel. Two levels, each a step deeper into the cryptic dance of numbers and logic, await your prowess. Are you ready to discover the true inputs and reveal the concealed answers within? Find the key, communicate with our judge service, and claim your place among the elite who see beyond the familiar to the truth that lies beneath.</p>
<h4 id="analysis_1">Analysis<a class="headerlink" href="#analysis_1" title="Permanent link">&para;</a></h4>
<p>We are given 2 circom circuits (respectively level1 and level2) and required to reveal the inputs.</p>
<div class="highlight"><pre><span></span><code>template Level1() {
    signal input in;
    signal output out;
    out &lt;== 1;
    component lt = LessThan(201);
    lt.in[0] &lt;== in;
    lt.in[1] &lt;== 6026017665971213533282357846279359759458261226685473132380160;
    lt.out === out;
    component gt = GreaterThan(201);
    gt.in[0] &lt;== in;
    gt.in[1] &lt;== -401734511064747568885490523085290650630550748445698208825344;
    gt.out === out;
}
</code></pre></div>
<p>Level1 circuit constrains the <code>out</code> signal to 1, and the <code>in</code> signal less than <code>6026017665971213533282357846279359759458261226685473132380160</code> and greater than <code>-401734511064747568885490523085290650630550748445698208825344</code>. Note that the input is <strong>expected</strong> to be a number with 201 bits but <code>LessThan</code> and <code>GreaterThan</code> template never checks it is within the valid range. This attack vector is well explained <a href="https://github.com/0xPARC/zk-bug-tracker?tab=readme-ov-file#4-mismatching-bit-lengths">here</a></p>
<p>To pass the circuit, we only need to find a number whose 202th bit is 0 within [0, 2**201).</p>
<div class="highlight"><pre><span></span><code><span class="mi">6026017665971213533282357846279359759458261226685473132380160</span> <span class="o">%</span> <span class="mi">2</span><span class="o">**</span><span class="n">n</span>
<span class="c1"># 2812141577453232982198433661597034554413855239119887461777408</span>
<span class="o">-</span><span class="mi">401734511064747568885490523085290650630550748445698208825344</span> <span class="o">%</span> <span class="mi">2</span><span class="o">**</span><span class="n">n</span>
<span class="c1"># 2812141577453232982198433661597034554413855239119887461777408</span>
</code></pre></div>
<p>Do the same operation with level2 circuit:</p>
<div class="highlight"><pre><span></span><code><span class="mi">3533700027045102098369050084895387317199177651876580346993442643999981568</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">241</span><span class="p">)</span>
<span class="c1"># 5897488333439202455083409550285544209858125342430750230241414742016</span>
<span class="o">-</span><span class="mi">3618502782768642773547390826438087570129142810943142283802299270005870559232</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">251</span><span class="p">)</span>
<span class="c1"># 5897488333439202455083409550285544209858125342430750230241414742016</span>
</code></pre></div>
<p>Note that we need to constrain the length of input of level2 circuit to be great and equal than 70. We can make use of the characteristics of field operations again, which is known as input alias issue. </p>
<div class="highlight"><pre><span></span><code>input_of_level2 = 5897488333439202455083409550285544209858125342430750230241414742016 + p
</code></pre></div>
<p>Because this is just a check in javascript, we can simply add some leading-zero before the input, saying <code>00005897488333439202455083409550285544209858125342430750230241414742016</code> to bypass this check.</p>
<h3 id="what-a-waste">What a Waste<a class="headerlink" href="#what-a-waste" title="Permanent link">&para;</a></h3>
<p>We are given a Round 2 seed random value but nothing else and required to forge a proof.</p>
<p>Emmm... Try to figure it out next time.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2025年3月17日 19:19:20">2025年3月17日 19:19:20</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="贡献者">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:xor0v0@163.com">Xor0v0</a>
    </nav>
  </span>

    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2030 Xor0v0
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.tracking", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>